<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <title>Chat bot bitch</title>
  </head>
<body>
  <h1>Hey I am a chatbot</h1>


  

  <form id="message-form">
  	<input type="text" name="message" id="message" required>
  	<input type="submit" value="Send" class="btn btn-primary btn-lg">
  </form>

  <form id="clear">
  	<input type="submit" value="Clear" class="btn btn-primary btn-lg">
  </form>
      <ul id="message-list" class="list-group-item list-group-item-primary"></>
  	<li ></li>
  	  <div id="buttoncreator"></div>
  </ul>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
 
<script type="text/javascript">
	$("button").click(function() {
	    var fired_button = $(this).val();
	    alert(fired_button);
	});
</script>




<script>

	console.log(window.location)

	var loc = (window.location)
	
	var wsStart = 'ws://' 
	if (loc.protocol == "https:"){
		wsStart = 'wss://'
	}
	var endpoint = wsStart + window.location.host + window.location.pathname
	var socket = new WebSocket(endpoint)


	socket.onmessage = function(e){
		console.log("message", e);
		const ul = document.getElementById('message-list')
		var li = document.createElement('li')
		if ((event.data).search("#")==-1){
			li.append(document.createTextNode(event.data))
			ul.prepend(li);
	       }
	    if ((event.data).search("#")!=-1){
	    	var choices = (event.data).split("#")
	    	var str = ''

	    		choices.forEach(function(choice) {
	    			str+= '<button type="button" class="btn btn-outline-primary" id="'+choice+'" name="'+choice+ '" value="'+choice+ '">'+choice+ '</button>'
	    		}); 
                console.log(str)
	    		document.getElementById("buttoncreator").innerHTML = str;
			
	       }

	}


	socket.onopen = function(e){
		console.log("open", e)
		socket.send("Thanks for connecting");
	}


	socket.onerror = function(e){
		console.log("error", e)
	}


	socket.onclose = function(e){
		console.log("close", e)
	}


	const messageForm = document.getElementById("message-form")
	messageForm.addEventListener('submit', sendMessage)
	function sendMessage(e){
		if (e.preventDefault) e.preventDefault();
		socket.send(document.getElementById('message').value);
		messageForm.reset()
		return false;

	}
</script>
<!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>


</body>
</html>